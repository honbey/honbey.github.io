<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-09-08 Thu 01:44 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python</title>
<meta name="author" content="Honbey Zhang" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="../resources/orgmode.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/style.css" type="text/css"/>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Python</h1>
</header>
<div id="outline-container-org124b3ab" class="outline-2">
<h2 id="org124b3ab">Some Useful Modules</h2>
<div class="outline-text-2" id="text-org124b3ab">
</div>
<div id="outline-container-orgac2bb87" class="outline-3">
<h3 id="orgac2bb87">numpy - Scientific calculation</h3>
<div class="outline-text-3" id="text-orgac2bb87">
<p>
Numpy remove scientific notation<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/env/bin python</span>
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
np.set_printoptions(suppress=<span style="color: #D0372D;">True</span>, formatter={
    <span style="color: #008000;">'float_kind'</span>: <span style="color: #008000;">'{:0.1f}'</span>.<span style="color: #006FE0;">format</span>
})
</pre>
</div>
</div>
</div>
<div id="outline-container-org51d788c" class="outline-3">
<h3 id="org51d788c">sqlaichemy - <a href="20220821-database.html#ID-787cf0fd-8725-403d-b115-a26c87d7dfcc">ORM</a></h3>
</div>

<div id="outline-container-orgea97371" class="outline-3">
<h3 id="orgea97371">re - <a href="20220820-regex.html#ID-36c84656-c086-40fc-9d40-a9181c4b7dc5">Regex</a>p</h3>
</div>

<div id="outline-container-ID-49846a46-321d-40b6-9ced-9791a2d43d5e" class="outline-3">
<h3 id="ID-49846a46-321d-40b6-9ced-9791a2d43d5e">seleium - Headless browser</h3>
<div class="outline-text-3" id="text-ID-49846a46-321d-40b6-9ced-9791a2d43d5e">
<p>
Selenium use specific browser:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> selenium <span style="color: #0000FF;">import</span> webdriver

<span style="color: #BA36A5;">driver_path</span> = <span style="color: #008000;">"C:/Users/username/PycharmProjects/chromedriver.exe"</span>
<span style="color: #BA36A5;">brave_path</span> = <span style="color: #008000;">"C:/Program Files (x86)/BraveSoftware/Brave-Browser/Application/brave.exe"</span>

<span style="color: #BA36A5;">option</span> = webdriver.ChromeOptions()
option.<span style="color: #BA36A5;">binary_location</span> = brave_path
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">option.add_argument("--incognito") OPTIONAL</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">option.add_argument("--headless") OPTIONAL</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Create new Instance of Chrome</span>
<span style="color: #BA36A5;">browser</span> = webdriver.Chrome(executable_path=driver_path, chrome_options=option)

browser.get(<span style="color: #008000;">"https://www.baidu.com"</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org63ac19c" class="outline-2">
<h2 id="org63ac19c">Dict</h2>
<div class="outline-text-2" id="text-org63ac19c">
</div>
<div id="outline-container-ID-66cc9aaa-af3c-40e9-b380-c51b42eab498" class="outline-3">
<h3 id="ID-66cc9aaa-af3c-40e9-b380-c51b42eab498">Merge dictionary in Python</h3>
<div class="outline-text-3" id="text-ID-66cc9aaa-af3c-40e9-b380-c51b42eab498">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">a</span>, <span style="color: #BA36A5;">b</span> = {<span style="color: #008000;">'a'</span>: <span style="color: #D0372D;">1</span>}, {<span style="color: #008000;">'b'</span>: <span style="color: #D0372D;">2</span>}
</pre>
</div>
<ol class="org-ol">
<li><p>
update()
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> copy <span style="color: #0000FF;">import</span> deepcopy
<span style="color: #BA36A5;">ab</span> = deepcopy(a)
ab.update(b)
</pre>
</div></li>
<li><p>
use <code>**</code> to destruct
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = {**a, **b}
</pre>
</div></li>
<li><p>
itertools
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">import</span> itertools
<span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(itertools.chain(a.items(), b.items()))
</pre>
</div></li>
<li><p>
ChainMap
This method will not update the value of same key.
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> collections <span style="color: #0000FF;">import</span> ChainMap
<span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(ChainMap(a, b))
</pre>
</div></li>
<li><p>
dict.items()
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(a.items() | b.items())
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">or</span>
<span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(<span style="color: #006FE0;">list</span>(a.items() + <span style="color: #006FE0;">list</span>(b.items())))
</pre>
</div></li>
<li><p>
Pythonnic
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = {k:v <span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> [a, b] <span style="color: #0000FF;">for</span> k, v <span style="color: #0000FF;">in</span> d.items()}
</pre>
</div></li>
<li><p>
Python 3.9
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = a | b
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org67701f8" class="outline-2">
<h2 id="org67701f8"><a href="20220708-information_security.html#ID-f206c9e0-f8d8-4b31-b74e-449365305a46">Information Security</a></h2>
<div class="outline-text-2" id="text-org67701f8">
</div>
<div id="outline-container-orgf688f26" class="outline-3">
<h3 id="orgf688f26">Avoid Directory Traversal Vulnerability<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="security">security</span></span></h3>
<div class="outline-text-3" id="text-orgf688f26">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/env/bin python</span>
<span style="color: #0000FF;">import</span> os

<span style="color: #BA36A5;">app_root</span> = <span style="color: #008000;">'/data/app'</span>
<span style="color: #BA36A5;">filename</span> = <span style="color: #008000;">'../../etc/passwd'</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">abspath = os.path.join(app_root, filename)</span>
<span style="color: #BA36A5;">abspath</span> = os.path.realpath(os.path.join(app_root, filename))

<span style="color: #0000FF;">if</span> os.path.commonprefix([app_root, abspath]) != app_root:
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'403 forbidden'</span>)
<span style="color: #0000FF;">else</span>:
    <span style="color: #006FE0;">print</span>(abspath)
</pre>
</div>
</div>
</div>
<div id="outline-container-ID-1c595ae5-2f2f-4b87-8434-f0cf681e424f" class="outline-3">
<h3 id="ID-1c595ae5-2f2f-4b87-8434-f0cf681e424f">Avoid SSRF<sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup></h3>
<div class="outline-text-3" id="text-ID-1c595ae5-2f2f-4b87-8434-f0cf681e424f">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">import</span> ipaddress
<span style="color: #0000FF;">import</span> dns.resolver
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Configure the whitelist to check</span>
<span style="color: #BA36A5;">DOMAINS_WHITELIST</span> = [<span style="color: #008000;">"baidu.com"</span>, <span style="color: #008000;">"labslinux"</span>]
<span style="color: #BA36A5;">DNS_RESOLVER</span> = dns.resolver.Resolver()
DNS_RESOLVER.<span style="color: #BA36A5;">nameservers</span> = [<span style="color: #008000;">"1.1.1.1"</span>]
<span style="color: #0000FF;">def</span> <span style="color: #006699;">verify_dns_records</span>(domain, records, <span style="color: #006FE0;">type</span>):
    <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">False</span>
    <span style="color: #0000FF;">if</span> records <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
        <span style="color: #0000FF;">for</span> record <span style="color: #0000FF;">in</span> records:
            value = record.to_text().strip()
            <span style="color: #0000FF;">try</span>:
                ip = ipaddress.ip_address(value)

                <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> ip.is_global:
                    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[!] DNS record type '%s' for domain name '%s' resolve to</span>
<span style="color: #008000;">                    a non public IP address '%s'!"</span> % (<span style="color: #006FE0;">type</span>, domain, value))
                    <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">True</span>
            <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">ValueError</span>:
                error_detected = <span style="color: #D0372D;">True</span>
                <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[!] '%s' is not valid IP address!"</span> % value)
    <span style="color: #0000FF;">return</span> error_detected
<span style="color: #0000FF;">def</span> <span style="color: #006699;">check</span>():
    <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">False</span>
    <span style="color: #0000FF;">for</span> domain <span style="color: #0000FF;">in</span> DOMAINS_WHITELIST:
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Get the IPs of the current domain</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">See https://en.wikipedia.org/wiki/List_of_DNS_record_types</span>
        <span style="color: #0000FF;">try</span>:
            <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A = IPv4 address record</span>
            <span style="color: #BA36A5;">ip_v4_records</span> = DNS_RESOLVER.query(domain, <span style="color: #008000;">"A"</span>)
        <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">Exception</span> <span style="color: #0000FF;">as</span> <span style="color: #BA36A5;">e</span>:
            ip_v4_records = <span style="color: #D0372D;">None</span>
            <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[i] Cannot get A record for domain '%s': %s\n"</span> % (domain,e))
        <span style="color: #0000FF;">try</span>:
           ip_v6_records = DNS_RESOLVER.query(domain, <span style="color: #008000;">"AAAA"</span>)
        <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">Exception</span> <span style="color: #0000FF;">as</span> <span style="color: #BA36A5;">e</span>:
            ip_v6_records = <span style="color: #D0372D;">None</span>
            <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[i] Cannot get AAAA record for domain '%s': %s\n"</span> % (domain,e))
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Verify the IPs obtained</span>
        <span style="color: #0000FF;">if</span> verify_dns_records(domain, ip_v4_records, <span style="color: #008000;">"A"</span>)
        <span style="color: #0000FF;">or</span> verify_dns_records(domain, ip_v6_records, <span style="color: #008000;">"AAAA"</span>):
            <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">True</span>
    <span style="color: #0000FF;">return</span> error_detected
<span style="color: #0000FF;">if</span> <span style="color: #006FE0;">__name__</span>== <span style="color: #008000;">"__main__"</span>:
    <span style="color: #0000FF;">if</span> check():
        <span style="color: #D0372D;">exit</span>(<span style="color: #D0372D;">1</span>)
    <span style="color: #0000FF;">else</span>:
        <span style="color: #D0372D;">exit</span>(<span style="color: #D0372D;">0</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga76bbde" class="outline-2">
<h2 id="orga76bbde">playground</h2>
<div class="outline-text-2" id="text-orga76bbde">
<div class="org-src-container">
<pre class="src src-python-jit">print('Hello world')
</pre>
</div>
<div class="klipsify div" id="org2ac5b90">
<script>window.klipse_settings = {selector_eval_python_client: '.src-python-jit',};</script>
<script src="https://storage.googleapis.com/app.klipse.tech/plugin_prod/js/klipse_plugin.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">

</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
参考 <a href="https://stackoverflow.com/questions/9777783/suppress-scientific-notation-in-numpy-when-creating-array-from-nested-list">stackoverflow 的回答</a>， <a href="https://numpy.org/doc/stable/reference/generated/numpy.set_printoptions.html">官方文档</a>有每个配置项的说明。
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
参考 <a href="https://github.com/streamlit/streamlit/commit/80d9979d5f4a00217743d607078a1d867fad8acf">streamlit 的补丁</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
参考 <a href="https://blog.csdn.net/qq_34974749/article/details/112424693">CSDN 博主 oxff644 的文章《SSRF漏洞原理及应用》</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<a href="https://beian.miit.gov.cn" target="_blank">湘ICP证019014083号</a>
</div>
</body>
</html>
