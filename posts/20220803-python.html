<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-12-03 Sun 16:50 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python</title>
<meta name="author" content="Honbey Zhang" />
<meta name="generator" content="Org Mode" />

                     <link rel="stylesheet" href="../resources/src/bigblow_theme/css/htmlize.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/src/bigblow_theme/css/bigblow.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/src/bigblow_theme/css/hideshow.css" type="text/css"/>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/bigblow.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/hideshow.js"></script>
                     <script type="text/javascript" src="../resources/src/lib/js/jquery.stickytableheaders.min.js"></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Python</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org7591722">Some Useful Modules</a>
<ul>
<li><a href="#org5ed3d15">numpy - Scientific calculation</a></li>
<li><a href="#org301d7bb">re - Regexp</a></li>
<li><a href="#orgb83209b">sqlalchemy - ORM</a></li>
<li><a href="#org81e863f">seleium - Headless browser</a></li>
<li><a href="#orgfb49a24">pandas</a>
<ul>
<li><a href="#orgcbc5204">excel process</a></li>
<li><a href="#org66bbbb1">定位数据</a></li>
<li><a href="#org2ceb3a4">多级索引</a></li>
</ul>
</li>
<li><a href="#org83efdef">tensorflow</a>
<ul>
<li><a href="#orgd0a62f4">tensorflow-gpu 2.4.0 with conda on Windows 10</a></li>
<li><a href="#orgc6f8ed1">tensorflow on macOS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org644ac77">Dict</a>
<ul>
<li><a href="#org18720b6">Merge dictionary in Python</a></li>
</ul>
</li>
<li><a href="#org14d9831">Information Security</a>
<ul>
<li><a href="#org8e8b0ef">Avoid Directory Traversal Vulnerability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="security">security</span></span></a></li>
<li><a href="#org5094659">Avoid SSRF</a></li>
</ul>
</li>
<li><a href="#orgc823056">playground</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org7591722" class="outline-2">
<h2 id="org7591722">Some Useful Modules</h2>
<div class="outline-text-2" id="text-org7591722">
</div>
<div id="outline-container-org5ed3d15" class="outline-3">
<h3 id="org5ed3d15">numpy - Scientific calculation</h3>
<div class="outline-text-3" id="text-org5ed3d15">
<p>
Numpy remove scientific notation<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/env/bin python</span>
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
np.set_printoptions(suppress=<span style="color: #D0372D;">True</span>, formatter={
    <span style="color: #008000;">'float_kind'</span>: <span style="color: #008000;">'{:0.1f}'</span>.<span style="color: #006FE0;">format</span>
})
</pre>
</div>
</div>
</div>
<div id="outline-container-org301d7bb" class="outline-3">
<h3 id="org301d7bb">re - <a href="20220820-regex.html#ID-36c84656-c086-40fc-9d40-a9181c4b7dc5">Regex</a>p</h3>
</div>
<div id="outline-container-orgb83209b" class="outline-3">
<h3 id="orgb83209b">sqlalchemy - <a href="20220821-database.html#ID-787cf0fd-8725-403d-b115-a26c87d7dfcc">ORM</a></h3>
<div class="outline-text-3" id="text-orgb83209b">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">sqlalchemy</th>
<th scope="col" class="org-left">mysql</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">class/model</td>
<td class="org-left">table</td>
</tr>

<tr>
<td class="org-left">Column</td>
<td class="org-left">field</td>
</tr>

<tr>
<td class="org-left">instance</td>
<td class="org-left">record</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org81e863f" class="outline-3">
<h3 id="org81e863f">seleium - Headless browser</h3>
<div class="outline-text-3" id="text-org81e863f">
<p>
Selenium use specific browser:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> selenium <span style="color: #0000FF;">import</span> webdriver

<span style="color: #BA36A5;">driver_path</span> = <span style="color: #008000;">"C:/Users/username/PycharmProjects/chromedriver.exe"</span>
<span style="color: #BA36A5;">brave_path</span> = <span style="color: #008000;">"C:/Program Files (x86)/BraveSoftware/Brave-Browser/Application/brave.exe"</span>

<span style="color: #BA36A5;">option</span> = webdriver.ChromeOptions()
option.<span style="color: #BA36A5;">binary_location</span> = brave_path
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">option.add_argument("--incognito") OPTIONAL</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">option.add_argument("--headless") OPTIONAL</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Create new Instance of Chrome</span>
<span style="color: #BA36A5;">browser</span> = webdriver.Chrome(executable_path=driver_path, chrome_options=option)

browser.get(<span style="color: #008000;">"https://www.baidu.com"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfb49a24" class="outline-3">
<h3 id="orgfb49a24">pandas</h3>
<div class="outline-text-3" id="text-orgfb49a24">
</div>
<div id="outline-container-orgcbc5204" class="outline-4">
<h4 id="orgcbc5204">excel process</h4>
<div class="outline-text-4" id="text-orgcbc5204">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">pandas</th>
<th scope="col" class="org-left">excel</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">DataFrame</td>
<td class="org-left">work sheet</td>
</tr>

<tr>
<td class="org-left">Series</td>
<td class="org-left">column</td>
</tr>

<tr>
<td class="org-left">Index</td>
<td class="org-left">line heading</td>
</tr>

<tr>
<td class="org-left">row</td>
<td class="org-left">row/line</td>
</tr>

<tr>
<td class="org-left">NaN</td>
<td class="org-left">empty cell</td>
</tr>
</tbody>
</table>

<blockquote>
<p>
数据透视表（Pivot Table）是一种交互式的表，可以进行某些计算，如求和与计数等。所进行的计算与数据跟数据透视表中的排列有关。
之所以称为数据透视表，是因为可以动态地改变它们的版面布置，以便按照不同方式分析数据，也可以重新安排行号、列标和页字段。每一次改变版面布置时，数据透视表会立即按照新的布置重新计算数据。另外，如果原始数据发生更改，则可以更新数据透视表。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org66bbbb1" class="outline-4">
<h4 id="org66bbbb1">定位数据</h4>
<div class="outline-text-4" id="text-org66bbbb1">
<p>
<code>loc[]</code>  通过索引名/标签定位单行、单列、多行、多列，前闭后闭
</p>

<p>
<code>iloc[]</code> 通过索引位置定位单行、单列、多行、多列，前闭后开
</p>

<p>
<code>at[], iat[]</code> 定位单个的值
</p>
</div>
</div>
<div id="outline-container-org2ceb3a4" class="outline-4">
<h4 id="org2ceb3a4">多级索引</h4>
<div class="outline-text-4" id="text-org2ceb3a4">
<p>
<code>pd.MultiIndex.from_product([[list1], [list2]])</code>
</p>
</div>
</div>
</div>
<div id="outline-container-org83efdef" class="outline-3">
<h3 id="org83efdef">tensorflow</h3>
<div class="outline-text-3" id="text-org83efdef">
<p>
tensorflow 与 cuda, cudnn 对应关系：<a href="https://tensorflow.google.cn/install/source?hl=tr#gpu">https://tensorflow.google.cn/install/source?hl=tr#gpu</a>
</p>
</div>
<div id="outline-container-orgd0a62f4" class="outline-4">
<h4 id="orgd0a62f4">tensorflow-gpu 2.4.0 with conda on Windows 10</h4>
<div class="outline-text-4" id="text-orgd0a62f4">
<p>
requirements.txt:
</p>
<div class="org-src-container">
<pre class="src src-txt">python==3.8
tensorflow-gpu==2.4.0
cudatoolkit==11.0.3
cudnn==8.0.5.39 #(from conda-forge)
# conda search cudnn -c conda-forge
# conda install cudnn==8.0.5.39 -c conda-forge

scipy==1.4.1
numpy==1.19.2
matplotlib==3.2.1
opencv-python==4.2.0.34
tqdm==4.46.1
Pillow==8.2.0
h5py==2.10.0
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc6f8ed1" class="outline-4">
<h4 id="orgc6f8ed1">tensorflow on macOS</h4>
<div class="outline-text-4" id="text-orgc6f8ed1">
<div class="org-src-container">
<pre class="src src-sh">pip install tensorflow-macos tensorflow-metal
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org644ac77" class="outline-2">
<h2 id="org644ac77">Dict</h2>
<div class="outline-text-2" id="text-org644ac77">
</div>
<div id="outline-container-org18720b6" class="outline-3">
<h3 id="org18720b6">Merge dictionary in Python</h3>
<div class="outline-text-3" id="text-org18720b6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">a</span>, <span style="color: #BA36A5;">b</span> = {<span style="color: #008000;">'a'</span>: <span style="color: #D0372D;">1</span>}, {<span style="color: #008000;">'b'</span>: <span style="color: #D0372D;">2</span>}
</pre>
</div>
<ol class="org-ol">
<li><p>
update()
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> copy <span style="color: #0000FF;">import</span> deepcopy
<span style="color: #BA36A5;">ab</span> = deepcopy(a)
ab.update(b)
</pre>
</div></li>
<li><p>
use <code>**</code> to destruct
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = {**a, **b}
</pre>
</div></li>
<li><p>
itertools
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">import</span> itertools
<span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(itertools.chain(a.items(), b.items()))
</pre>
</div></li>
<li><p>
ChainMap
This method will not update the value of same key.
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">from</span> collections <span style="color: #0000FF;">import</span> ChainMap
<span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(ChainMap(a, b))
</pre>
</div></li>
<li><p>
dict.items()
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(a.items() | b.items())
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">or</span>
<span style="color: #BA36A5;">ab</span> = <span style="color: #006FE0;">dict</span>(<span style="color: #006FE0;">list</span>(a.items() + <span style="color: #006FE0;">list</span>(b.items())))
</pre>
</div></li>
<li><p>
Pythonnic
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = {k:v <span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> [a, b] <span style="color: #0000FF;">for</span> k, v <span style="color: #0000FF;">in</span> d.items()}
</pre>
</div></li>
<li><p>
Python 3.9
Example:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #BA36A5;">ab</span> = a | b
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org14d9831" class="outline-2">
<h2 id="org14d9831"><a href="20220708-information_security.html#ID-f206c9e0-f8d8-4b31-b74e-449365305a46">Information Security</a></h2>
<div class="outline-text-2" id="text-org14d9831">
</div>
<div id="outline-container-org8e8b0ef" class="outline-3">
<h3 id="org8e8b0ef">Avoid Directory Traversal Vulnerability<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="security">security</span></span></h3>
<div class="outline-text-3" id="text-org8e8b0ef">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/env/bin python</span>
<span style="color: #0000FF;">import</span> os

<span style="color: #BA36A5;">app_root</span> = <span style="color: #008000;">'/data/app'</span>
<span style="color: #BA36A5;">filename</span> = <span style="color: #008000;">'../../etc/passwd'</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">abspath = os.path.join(app_root, filename)</span>
<span style="color: #BA36A5;">abspath</span> = os.path.realpath(os.path.join(app_root, filename))

<span style="color: #0000FF;">if</span> os.path.commonprefix([app_root, abspath]) != app_root:
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'403 forbidden'</span>)
<span style="color: #0000FF;">else</span>:
    <span style="color: #006FE0;">print</span>(abspath)
</pre>
</div>
</div>
</div>
<div id="outline-container-org5094659" class="outline-3">
<h3 id="org5094659">Avoid SSRF<sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup></h3>
<div class="outline-text-3" id="text-org5094659">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">import</span> ipaddress
<span style="color: #0000FF;">import</span> dns.resolver
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Configure the whitelist to check</span>
<span style="color: #BA36A5;">DOMAINS_WHITELIST</span> = [<span style="color: #008000;">"baidu.com"</span>, <span style="color: #008000;">"labslinux"</span>]
<span style="color: #BA36A5;">DNS_RESOLVER</span> = dns.resolver.Resolver()
DNS_RESOLVER.<span style="color: #BA36A5;">nameservers</span> = [<span style="color: #008000;">"1.1.1.1"</span>]
<span style="color: #0000FF;">def</span> <span style="color: #006699;">verify_dns_records</span>(domain, records, <span style="color: #006FE0;">type</span>):
    <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">False</span>
    <span style="color: #0000FF;">if</span> records <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
        <span style="color: #0000FF;">for</span> record <span style="color: #0000FF;">in</span> records:
            <span style="color: #BA36A5;">value</span> = record.to_text().strip()
            <span style="color: #0000FF;">try</span>:
                <span style="color: #BA36A5;">ip</span> = ipaddress.ip_address(value)

                <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> ip.is_global:
                    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[!] DNS record type '%s' for domain name '%s' resolve to</span>
<span style="color: #008000;">                    a non public IP address '%s'!"</span> % (<span style="color: #006FE0;">type</span>, domain, value))
                    <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">True</span>
            <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">ValueError</span>:
                <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">True</span>
                <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[!] '%s' is not valid IP address!"</span> % value)
    <span style="color: #0000FF;">return</span> error_detected
<span style="color: #0000FF;">def</span> <span style="color: #006699;">check</span>():
    <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">False</span>
    <span style="color: #0000FF;">for</span> domain <span style="color: #0000FF;">in</span> DOMAINS_WHITELIST:
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Get the IPs of the current domain</span>
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">See https://en.wikipedia.org/wiki/List_of_DNS_record_types</span>
        <span style="color: #0000FF;">try</span>:
            <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A = IPv4 address record</span>
            <span style="color: #BA36A5;">ip_v4_records</span> = DNS_RESOLVER.query(domain, <span style="color: #008000;">"A"</span>)
        <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">Exception</span> <span style="color: #0000FF;">as</span> e:
            <span style="color: #BA36A5;">ip_v4_records</span> = <span style="color: #D0372D;">None</span>
            <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[i] Cannot get A record for domain '%s': %s</span><span style="color: #D0372D;">\n</span><span style="color: #008000;">"</span> % (domain,e))
        <span style="color: #0000FF;">try</span>:
           <span style="color: #BA36A5;">ip_v6_records</span> = DNS_RESOLVER.query(domain, <span style="color: #008000;">"AAAA"</span>)
        <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">Exception</span> <span style="color: #0000FF;">as</span> e:
            <span style="color: #BA36A5;">ip_v6_records</span> = <span style="color: #D0372D;">None</span>
            <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"[i] Cannot get AAAA record for domain '%s': %s</span><span style="color: #D0372D;">\n</span><span style="color: #008000;">"</span> % (domain,e))
        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Verify the IPs obtained</span>
        <span style="color: #0000FF;">if</span> verify_dns_records(domain, ip_v4_records, <span style="color: #008000;">"A"</span>)
        <span style="color: #0000FF;">or</span> verify_dns_records(domain, ip_v6_records, <span style="color: #008000;">"AAAA"</span>):
            <span style="color: #BA36A5;">error_detected</span> = <span style="color: #D0372D;">True</span>
    <span style="color: #0000FF;">return</span> error_detected
<span style="color: #0000FF;">if</span> <span style="color: #006FE0;">__name__</span>== <span style="color: #008000;">"__main__"</span>:
    <span style="color: #0000FF;">if</span> check():
        <span style="color: #D0372D;">exit</span>(<span style="color: #D0372D;">1</span>)
    <span style="color: #0000FF;">else</span>:
        <span style="color: #D0372D;">exit</span>(<span style="color: #D0372D;">0</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc823056" class="outline-2">
<h2 id="orgc823056">playground</h2>
<div class="outline-text-2" id="text-orgc823056">
<div class="org-src-container">
<pre class="src src-python-jit">print('Hello world')
</pre>
</div>
<div class="klipsify div" id="org151e085">
<script>window.klipse_settings = {selector_eval_python_client: '.src-python-jit',};</script>
<script src="https://storage.googleapis.com/app.klipse.tech/plugin_prod/js/klipse_plugin.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">

</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://stackoverflow.com/questions/9777783/suppress-scientific-notation-in-numpy-when-creating-array-from-nested-list">stackoverflow 的回答</a>， <a href="https://numpy.org/doc/stable/reference/generated/numpy.set_printoptions.html">官方文档</a>有每个配置项的说明。
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://github.com/streamlit/streamlit/commit/80d9979d5f4a00217743d607078a1d867fad8acf">streamlit 的补丁</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://blog.csdn.net/qq_34974749/article/details/112424693">CSDN 博主 oxff644 的文章《SSRF漏洞原理及应用》</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">

                     Theme
                     <a href="https://github.com/fniessen/org-html-themes" target="_blank">bigblow</a>
                     by
                     <a href="https://github.com/fniessen" target="_blank">fniessen</a>
                     <br>
                     <a href="https://beian.miit.gov.cn" target="_blank">湘ICP证019014083号</a>
</div>
</body>
</html>