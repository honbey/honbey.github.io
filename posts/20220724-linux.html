<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-08-25 Thu 21:34 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux</title>
<meta name="author" content="Honbey Zhang" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="../resources/orgmode.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/style.css" type="text/css"/>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux</h1>
</header>
<div id="outline-container-ID-a22d50a1-2a30-499c-b6f7-25d65e2016e3" class="outline-2">
<h2 id="ID-a22d50a1-2a30-499c-b6f7-25d65e2016e3">Architecture</h2>
<div class="outline-text-2" id="text-orgf04abe1">
<pre class="example">
   Application
Shell | Lib Function
   System Call
   Kernel
</pre>
</div>
</div>

<div id="outline-container-ID-3cedef2b-ff4a-492e-a8e0-7a1a4779a407" class="outline-2">
<h2 id="ID-3cedef2b-ff4a-492e-a8e0-7a1a4779a407">I/O</h2>
<div class="outline-text-2" id="text-orgd95bded">
<p>
传统 I/O （缓存 I/O）：硬盘 -&gt; 内核缓冲区 -&gt; 用户缓冲区 -&gt; 内核 socket 缓冲区 -&gt; 协议引擎
</p>

<p>
sendfile: 硬盘 -&gt; 内核缓冲区 -&gt; 内核 socket 缓冲区 -&gt; 协议引擎
</p>

<p>
sendfile（DMA 收集拷贝）：硬盘 -&gt; 内核缓冲区 -&gt; 协议引擎
</p>
</div>

<div id="outline-container-org0b81513" class="outline-3">
<h3 id="org0b81513">零拷贝技术 - sendfile</h3>
<div class="outline-text-3" id="text-org0b81513">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #808080;">#include</span> <span style="color: #707183;">&lt;</span><span style="color: #008000;">sys/sendfile.h</span><span style="color: #707183;">&gt;</span>
<span style="color: #6434A3;">ssize_t</span> <span style="color: #006699;">snedfile</span><span style="color: #707183;">(</span><span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">out_fd</span>, <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">in_fd</span>, <span style="color: #6434A3;">off_t</span>* <span style="color: #BA36A5;">offset</span>, <span style="color: #6434A3;">size_t</span> <span style="color: #BA36A5;">count</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
sendfile 函数是在两个文件描述符中直接传递数据（完全在内核中操作），从而避免了用户缓冲区和内核缓冲区之间的数据拷贝，操作效率很高。
</p>
</div>
</div>
</div>

<div id="outline-container-org82db111" class="outline-2">
<h2 id="org82db111">Useful Command</h2>
<div class="outline-text-2" id="text-org82db111">
</div>
<div id="outline-container-org08f657c" class="outline-3">
<h3 id="org08f657c">Let non-root/normal user use port which less then 1024</h3>
<div class="outline-text-3" id="text-org08f657c">
<div class="org-src-container">
<pre class="src src-bash">setcap <span style="color: #BA36A5;">cap_net_bind_service</span>=+eip /path/executable_program
</pre>
</div>
</div>
</div>

<div id="outline-container-ID-30464b22-0321-4bd8-846f-7d2ee1b1af4c" class="outline-3">
<h3 id="ID-30464b22-0321-4bd8-846f-7d2ee1b1af4c">Recover files on Linux</h3>
<div class="outline-text-3" id="text-orgc20d347">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">backup sector</span>
dd <span style="color: #BA36A5;">if</span>=/path/filename <span style="color: #BA36A5;">of</span>=/dev/vda1
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">unmount</span>
umount /dev/vda1
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">force unmount</span>
fuser -m -v -i -k /dev/vda1
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">scan</span>
extundelete --inode <span style="color: #D0372D;">2</span> /dev/vda1
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">recover</span>
extundelete /dev/vda1 --restore-all
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<a href="https://beian.miit.gov.cn" target="_blank">湘ICP证019014083号</a>
</div>
</body>
</html>
