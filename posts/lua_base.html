<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-12-03 Sun 16:49 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lua è¯­è¨€åŸºç¡€</title>
<meta name="author" content="Honbey Zhang" />
<meta name="generator" content="Org Mode" />

                     <link rel="stylesheet" href="../resources/src/bigblow_theme/css/htmlize.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/src/bigblow_theme/css/bigblow.css" type="text/css"/>
                     <link rel="stylesheet" href="../resources/src/bigblow_theme/css/hideshow.css" type="text/css"/>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/bigblow.js"></script>
                     <script type="text/javascript" src="../resources/src/bigblow_theme/js/hideshow.js"></script>
                     <script type="text/javascript" src="../resources/src/lib/js/jquery.stickytableheaders.min.js"></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Lua è¯­è¨€åŸºç¡€</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org58766d0">Lua</a>
<ul>
<li><a href="#orgb692104">äº¤äº’å¼</a></li>
<li><a href="#orgd62009e">æ³¨é‡Š</a></li>
<li><a href="#orgf66bb0c">æ ‡ç¤ºç¬¦</a></li>
<li><a href="#orgad85587">Lua å…³é”®å­—</a></li>
<li><a href="#orgd2097b3">Lua è¿ç®—ç¬¦</a>
<ul>
<li><a href="#org5a0e93d">è¿ç®—ç¬¦ä¼˜å…ˆçº§</a></li>
</ul>
</li>
<li><a href="#orge7938c0">Lua å˜é‡</a></li>
<li><a href="#orgcf1af35">Lua è¯­æ³•ç»“æ„</a>
<ul>
<li><a href="#orgb2ab900">å¾ªç¯</a></li>
<li><a href="#orgb24e6e5">æµç¨‹æ§åˆ¶</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1bc6903">Lua æ•°æ®ç±»å‹</a></li>
<li><a href="#org7a95e6e">Lua å‡½æ•°</a>
<ul>
<li><a href="#orgbc9ba32">å¯å˜å‚æ•°</a></li>
</ul>
</li>
<li><a href="#org9e7a612">Lua å­—ç¬¦ä¸²</a>
<ul>
<li><a href="#org7fb5dbb">å­—ç¬¦ä¸²æ–¹æ³•</a></li>
<li><a href="#org7dd9081">åŒ¹é…æ¨¡å¼</a></li>
</ul>
</li>
<li><a href="#org0a20a63">Lua æ•°ç»„</a>
<ul>
<li><a href="#orgad7ef18">ä¸€ç»´æ•°ç»„</a></li>
<li><a href="#org5e34821">å¤šç»´æ•°ç»„</a></li>
</ul>
</li>
<li><a href="#org333ccee">Lua è¿­ä»£å™¨</a>
<ul>
<li><a href="#orgb6009d6">æ³›å‹ for è¿­ä»£å™¨</a></li>
<li><a href="#orgd243fa9">æ— çŠ¶æ€çš„è¿­ä»£å™¨</a></li>
<li><a href="#org43b4e30">å¤šçŠ¶æ€çš„è¿­ä»£å™¨</a></li>
</ul>
</li>
<li><a href="#org7cd2018">Lua è¡¨ table</a>
<ul>
<li><a href="#org109aeff">å¸¸ç”¨æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#org58d582e">Lua æ¨¡å—ä¸åŒ…</a>
<ul>
<li><a href="#org34a8f72">require å‡½æ•°</a></li>
<li><a href="#org1836a8d">åŠ è½½æœºåˆ¶</a></li>
<li><a href="#orgdb047a6">C åŒ…</a></li>
</ul>
</li>
<li><a href="#org595f60a">Lua å…ƒè¡¨ Metatable</a>
<ul>
<li><a href="#org421d22a"><code>__index</code> å…ƒæ–¹æ³•</a></li>
<li><a href="#org52d5b5b"><code>__newindex</code> å…ƒæ–¹æ³•</a></li>
<li><a href="#org153d759"><code>__call</code> å…ƒæ–¹æ³•</a></li>
<li><a href="#orgbf294e2"><code>__string</code> å…ƒæ–¹æ³•</a></li>
<li><a href="#org78e2edb">å…¶ä»–å…ƒæ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#orgf6ef60d">Lua ååŒç¨‹åº coroutine</a>
<ul>
<li><a href="#orga610242">çº¿ç¨‹å’ŒååŒç¨‹åºåŒºåˆ«</a></li>
<li><a href="#org2a6dd93">åŸºæœ¬æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#org67baa02">Lua I/O</a>
<ul>
<li><a href="#orgf315889">ç®€å•æ¨¡å¼</a></li>
<li><a href="#org483d48e">å®Œå…¨æ¨¡å¼</a></li>
</ul>
</li>
<li><a href="#orgc788674">Lua é”™è¯¯å¤„ç†</a>
<ul>
<li><a href="#org0c23ae5">assert()</a></li>
<li><a href="#orgf2e4395">error()</a></li>
<li><a href="#org28c8ef0">pcall, xpcall</a></li>
<li><a href="#orge42d833">debug åº“</a></li>
</ul>
</li>
<li><a href="#org569a4ac">Lua åƒåœ¾å›æ”¶</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org58766d0" class="outline-2">
<h2 id="org58766d0">Lua</h2>
<div class="outline-text-2" id="text-org58766d0">
<p>
TOC:
</p>
<ul class="org-ul">
<li><a href="#org1bc6903">Lua æ•°æ®ç±»å‹</a></li>
<li><a href="#org7a95e6e">Lua å‡½æ•°</a></li>
<li><a href="#org9e7a612">Lua å­—ç¬¦ä¸²</a></li>
<li><a href="#org0a20a63">Lua æ•°ç»„</a></li>
<li><a href="#org333ccee">Lua è¿­ä»£å™¨</a></li>
<li><a href="#org7cd2018">Lua è¡¨ table</a></li>
<li><a href="#org595f60a">Lua å…ƒè¡¨ Metatable</a></li>
<li><a href="#org58d582e">Lua æ¨¡å—ä¸åŒ…</a></li>
<li><a href="#orgf6ef60d">Lua ååŒç¨‹åº coroutine</a></li>
<li><a href="#org67baa02">Lua I/O</a></li>
<li><a href="#orgc788674">Lua é”™è¯¯å¤„ç†</a></li>
<li><a href="#org569a4ac">Lua åƒåœ¾å›æ”¶</a></li>
</ul>

<p>
åº”ç”¨ï¼š
</p>
<ul class="org-ul">
<li><a href="install_lua_resty_waf.html#ID-f30d98cd-d9d7-480b-987b-451979c1adb1">å®‰è£…ä½¿ç”¨ lua-resty-waf</a></li>
</ul>

<p>
åŸºäº C çš„è„šæœ¬è¯­è¨€ã€‚
</p>
</div>
<div id="outline-container-orgb692104" class="outline-3">
<h3 id="orgb692104">äº¤äº’å¼</h3>
<div class="outline-text-3" id="text-orgb692104">
<div class="org-src-container">
<pre class="src src-bash">lua
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">or</span>
lua -i
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd62009e" class="outline-3">
<h3 id="orgd62009e">æ³¨é‡Š</h3>
<div class="outline-text-3" id="text-orgd62009e">
<p>
ç‰¹ä¾‹ï¼šshebang <code>#~/usr/bin/env lua</code>
</p>

<p>
å•è¡Œæ³¨é‡Šï¼š
</p>
<div class="org-src-container">
<pre class="src src-lua">-- æ³¨é‡Š
</pre>
</div>

<p>
å¤šè¡Œæ³¨é‡Šï¼š
</p>
<div class="org-src-container">
<pre class="src src-lua">--[[
  æ³¨é‡Š [a]...
  æ³¨é‡Š
--]]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf66bb0c" class="outline-3">
<h3 id="orgf66bb0c">æ ‡ç¤ºç¬¦</h3>
<div class="outline-text-3" id="text-orgf66bb0c">
<p>
å®šä¹‰å˜é‡ï¼Œä»¥å­—æ¯ <code>a-zA-Z</code> æˆ–ä¸‹åˆ’çº¿ <code>_</code> å¼€å¤´ï¼Œåæ¥æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ç»„æˆï¼Œä¸å…è®¸ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¦‚ <code>@, $, %</code> æ¥å®šä¹‰æ ‡ç¤ºç¬¦ï¼ŒåŒºåˆ†å¤§å°å†™
</p>
</div>
</div>
<div id="outline-container-orgad85587" class="outline-3">
<h3 id="orgad85587">Lua å…³é”®å­—</h3>
<div class="outline-text-3" id="text-orgad85587">
<div class="org-src-container">
<pre class="src src-nil">| and      | break | do    | else   |
| elseif   | end   | false | for    |
| function | if    | in    | local  |
| nil      | not   | or    | repeat |
| return   | then  | true  | until  |
| while    | goto  |       |        |
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd2097b3" class="outline-3">
<h3 id="orgd2097b3">Lua è¿ç®—ç¬¦</h3>
<div class="outline-text-3" id="text-orgd2097b3">
<p>
ç®—æœ¯è¿ç®—ç¬¦ï¼š
</p>
<ul class="org-ul">
<li>+ åŠ æ³•</li>
<li>+ å‡æ³•</li>
<li>* ä¹˜æ³•</li>
<li>/ é™¤æ³•</li>
<li>% å–ä½™</li>
<li>^ ä¹˜å¹‚</li>
<li>- è´Ÿå·</li>
</ul>

<p>
å…³ç³»è¿ç®—ç¬¦ï¼š
</p>
<ul class="org-ul">
<li>== ç­‰äº</li>
<li>~= ä¸ç­‰äº</li>
<li>&gt;</li>
<li>&lt;</li>
<li>&gt;=</li>
<li>&lt;=</li>
</ul>

<p>
é€»è¾‘è¿ç®—ç¬¦ï¼š
</p>
<ul class="org-ul">
<li>and ä¸</li>
<li>or  æˆ–</li>
<li>not é</li>
</ul>

<p>
å…¶ä»–è¿ç®—ç¬¦ï¼š
</p>
<ul class="org-ul">
<li>.. è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</li>
<li>#  ä¸€å…ƒè¿ç®—ç¬¦ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦</li>
</ul>
</div>
<div id="outline-container-org5a0e93d" class="outline-4">
<h4 id="org5a0e93d">è¿ç®—ç¬¦ä¼˜å…ˆçº§</h4>
<div class="outline-text-4" id="text-org5a0e93d">
<div class="org-src-container">
<pre class="src src-nil">^
not  - (unary)
/    *         %
+    -
..
&lt;    &gt;        &lt;=  &gt;=  ~=  ==
and
or
</pre>
</div>

<p>
é™¤äº† <code>^</code> å’Œ <code>..</code> å¤–æ‰€æœ‰è¿ç®—ç¬¦éƒ½æ˜¯å·¦è¿æ¥çš„
</p>
</div>
</div>
</div>
<div id="outline-container-orge7938c0" class="outline-3">
<h3 id="orge7938c0">Lua å˜é‡</h3>
<div class="outline-text-3" id="text-orge7938c0">
<p>
lua çš„å˜é‡é»˜è®¤éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œé™¤éä½¿ç”¨ local è¿›è¡Œå£°æ˜
</p>

<p>
å…¨å±€å˜é‡ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡çš„å€¼ä¸º <code>nil</code> ã€‚
</p>

<p>
èµ‹å€¼ï¼šå¯å¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼ï¼Œå„å…ƒç´ ç”¨é€—å· <code>,</code> åˆ†éš”ï¼Œè‹¥å˜é‡ä¸ªæ•°å¤§äºå€¼çš„ä¸ªæ•°ï¼Œè¡¥ nilï¼Œåä¹‹å¿½ç•¥å¤šä½™çš„å€¼
</p>

<p>
ç´¢å¼•ï¼šä½¿ç”¨ <code>[]</code> è¿›è¡Œç´¢å¼•
</p>
</div>
</div>
<div id="outline-container-orgcf1af35" class="outline-3">
<h3 id="orgcf1af35">Lua è¯­æ³•ç»“æ„</h3>
<div class="outline-text-3" id="text-orgcf1af35">
</div>
<div id="outline-container-orgb2ab900" class="outline-4">
<h4 id="orgb2ab900">å¾ªç¯</h4>
<div class="outline-text-4" id="text-orgb2ab900">
<ul class="org-ul">
<li>while</li>
<li>for</li>
<li>repeat until</li>
</ul>

<p>
å¾ªç¯æ§åˆ¶è¯­å¥
</p>
<ul class="org-ul">
<li>break</li>
<li>goto</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua">while (true)
do
  print("Hello")
end

goto Label
::Label::
</pre>
</div>

<div class="org-src-container">
<pre class="src src-lua">for i=10, 1, -1 do
  print(i)
end
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb24e6e5" class="outline-4">
<h4 id="orgb24e6e5">æµç¨‹æ§åˆ¶</h4>
<div class="outline-text-4" id="text-orgb24e6e5">
<ul class="org-ul">
<li>if elseif else</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua">if (f == 1)
then
  code
elseif
then
  code
else
  code
end
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org1bc6903" class="outline-2">
<h2 id="org1bc6903">Lua æ•°æ®ç±»å‹</h2>
<div class="outline-text-2" id="text-org1bc6903">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">æ•°æ®ç±»å‹</th>
<th scope="col" class="org-left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">nil</td>
<td class="org-left">æ ‡ç¤ºæ— æ•ˆå€¼ï¼Œé€»è¾‘åˆ¤æ–­ä¸º false</td>
</tr>

<tr>
<td class="org-left">boolean</td>
<td class="org-left">å¸ƒå°”å€¼ï¼Œtrue / false</td>
</tr>

<tr>
<td class="org-left">number</td>
<td class="org-left">åŒç²¾åº¦å®æµ®ç‚¹æ•°</td>
</tr>

<tr>
<td class="org-left">string</td>
<td class="org-left">å•å¼•å·æˆ–åŒå¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²</td>
</tr>

<tr>
<td class="org-left">function</td>
<td class="org-left">ç”± C æˆ– lua ç¼–å†™çš„å‡½æ•°</td>
</tr>

<tr>
<td class="org-left">userdata</td>
<td class="org-left">ä»»æ„å­˜å‚¨åœ¨å˜é‡ä¸­çš„ C æ•°æ®ç»“æ„</td>
</tr>

<tr>
<td class="org-left">thread</td>
<td class="org-left">æ ‡ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿ç¨‹</td>
</tr>

<tr>
<td class="org-left">table</td>
<td class="org-left">å…³è”æ•°ç»„ associative arrays, {}</td>
</tr>
</tbody>
</table>

<blockquote>
<p>
<b>nil ä½œæ¯”è¾ƒæ—¶åº”è¯¥åŠ ä¸ŠåŒå¼•å·</b>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org7a95e6e" class="outline-2">
<h2 id="org7a95e6e">Lua å‡½æ•°</h2>
<div class="outline-text-2" id="text-org7a95e6e">
<div class="org-src-container">
<pre class="src src-lua">optional_function_scope function function_name( argument1, argument2, argument3..., argumentn)
  function_body
  return result_params_comma_separated
end
</pre>
</div>

<p>
optional<sub>function</sub><sub>scope</sub>: æŒ‡å®šå…¨å±€è¿˜æ˜¯å±€éƒ¨ï¼Œé»˜è®¤å…¨å±€ï¼Œä½¿ç”¨ local æŒ‡å®šä¸ºå±€éƒ¨
</p>
</div>
<div id="outline-container-orgbc9ba32" class="outline-3">
<h3 id="orgbc9ba32">å¯å˜å‚æ•°</h3>
<div class="outline-text-3" id="text-orgbc9ba32">
<p>
åœ¨å‡½æ•°åˆ—è¡¨ä¸­ä½¿ç”¨ä¸‰ç‚¹ <code>...</code> è¡¨ç¤ºå‡½æ•°æœ‰å¯å˜çš„å‚æ•°ï¼Œåœ¨å‡½æ•°ä¸­ä½¿ç”¨ <code>{...}</code> è¡¨ç¤ºç”±æ‰€æœ‰å˜é•¿å‚æ•°æ„æˆçš„æ•°ç»„ï¼Œä¹Ÿå¯ä½¿ç”¨ <code>select("#", ...)</code> æ¥è·å–å¯å˜å‚æ•°çš„æ•°é‡ï¼Œ <code>select(n, ...)</code> è¿”å›ä»èµ·ç‚¹ n å¼€å§‹åˆ°ç»“æŸä½ç½®çš„æ‰€æœ‰å‚æ•°åˆ—è¡¨ï¼Œå›ºå®šå‚æ•°å¿…é¡»æ”¾åœ¨å˜é•¿å‚æ•°ä¹‹å‰ã€‚
</p>
</div>
</div>
</div>
<div id="outline-container-org9e7a612" class="outline-2">
<h2 id="org9e7a612">Lua å­—ç¬¦ä¸²</h2>
<div class="outline-text-2" id="text-org9e7a612">
<p>
è¡¨ç¤ºæ–¹æ³•ï¼š
</p>
<ul class="org-ul">
<li>å•å¼•å· <code>''</code></li>
<li>åŒå¼•å· <code>""</code></li>
<li>åŒä¸­æ‹¬å· <code>[[]]</code></li>
</ul>

<p>
è½¬ä¹‰å­—ç¬¦åŒ C è¯­è¨€
</p>
</div>
<div id="outline-container-org7fb5dbb" class="outline-3">
<h3 id="org7fb5dbb">å­—ç¬¦ä¸²æ–¹æ³•</h3>
<div class="outline-text-3" id="text-org7fb5dbb">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">æ–¹æ³•</th>
<th scope="col" class="org-left">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">string.upper(argument)</td>
<td class="org-left">å°†å­—ç¬¦ä¸²å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™</td>
</tr>

<tr>
<td class="org-left">string.lower(argument)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">string.gsub(str, substr, replace, num)</td>
<td class="org-left">æ›¿æ¢</td>
</tr>

<tr>
<td class="org-left">string.find(str, substr[, init, [end]])</td>
<td class="org-left">æœç´¢</td>
</tr>

<tr>
<td class="org-left">string.reverse(argument)</td>
<td class="org-left">åè½¬</td>
</tr>

<tr>
<td class="org-left">string.format(&#x2026;)</td>
<td class="org-left">è¿”å›ä¸€ä¸ªç±»ä¼¼ printf çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</td>
</tr>

<tr>
<td class="org-left">string.char(argument)</td>
<td class="org-left">å°†æ•´å‹æ•°å­—è½¬ä¸ºå­—ç¬¦å¹¶è¿æ¥</td>
</tr>

<tr>
<td class="org-left">string.byte(argument[, int])</td>
<td class="org-left">è½¬æ¢å­—ç¬¦ä¸ºæ•´æ•°å€¼</td>
</tr>

<tr>
<td class="org-left">string.len(str)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">string.rep(str, n)</td>
<td class="org-left">è¿”å› n ä¸ª str çš„æ‹·è´</td>
</tr>

<tr>
<td class="org-left">..</td>
<td class="org-left">è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</td>
</tr>

<tr>
<td class="org-left">string.gmatch(str, pattern)</td>
<td class="org-left">è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°è¿”å›ç›¸åº”å­ä¸²ï¼Œæ— åˆ™ nil</td>
</tr>

<tr>
<td class="org-left">string.match(str, pattern, init)</td>
<td class="org-left">æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªåŒ¹é…</td>
</tr>

<tr>
<td class="org-left">string.sub(str, init[, end])</td>
<td class="org-left">æˆªå–</td>
</tr>
</tbody>
</table>

<p>
<code>string.format(...)</code> å‡½æ•°ç±»ä¼¼ <code>printf(...)</code> å‡½æ•°ï¼Œè½¬ä¹‰ç åŸºæœ¬ç›¸åŒ
</p>
</div>
</div>
<div id="outline-container-org7dd9081" class="outline-3">
<h3 id="org7dd9081">åŒ¹é…æ¨¡å¼</h3>
<div class="outline-text-3" id="text-org7dd9081">
<p>
å•ä¸ªå­—ç¬¦ä¸å…¶è‡ªèº«åŒ¹é… (é™¤ <code>^$()%*+-?</code> å¤–)
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">å­—ç¬¦ç±»</th>
<th scope="col" class="org-left">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>.</code></td>
<td class="org-left">ä¸ä»»ä½•å­—ç¬¦åŒ¹é…</td>
</tr>

<tr>
<td class="org-left"><code>%a</code></td>
<td class="org-left">å­—æ¯</td>
</tr>

<tr>
<td class="org-left"><code>%c</code></td>
<td class="org-left">æ§åˆ¶ç¬¦</td>
</tr>

<tr>
<td class="org-left"><code>%d</code></td>
<td class="org-left">æ•°å­—</td>
</tr>

<tr>
<td class="org-left"><code>%l</code></td>
<td class="org-left">å°å†™å­—æ¯</td>
</tr>

<tr>
<td class="org-left"><code>%p</code></td>
<td class="org-left">æ ‡ç‚¹ punctuation</td>
</tr>

<tr>
<td class="org-left"><code>%s</code></td>
<td class="org-left">ç©ºç™½å­—ç¬¦</td>
</tr>

<tr>
<td class="org-left"><code>%u</code></td>
<td class="org-left">å¤§å†™å­—æ¯</td>
</tr>

<tr>
<td class="org-left"><code>%w</code></td>
<td class="org-left">å­—æ¯/æ•°å­—</td>
</tr>

<tr>
<td class="org-left"><code>%x</code></td>
<td class="org-left">åå…­è¿›åˆ¶</td>
</tr>

<tr>
<td class="org-left"><code>%z</code></td>
<td class="org-left">è¡¨é›¶å­—ç¬¦</td>
</tr>

<tr>
<td class="org-left"><code>%x</code></td>
<td class="org-left">è½¬ä¹‰</td>
</tr>

<tr>
<td class="org-left"><code>[]</code></td>
<td class="org-left">å­—ç¬¦é›†</td>
</tr>

<tr>
<td class="org-left"><code>[^]</code></td>
<td class="org-left">éå­—ç¬¦é›†</td>
</tr>
</tbody>
</table>

<p>
å¤§å†™ z åŠä¹‹å‰çš„å­—æ¯è¡¨ç¤º <b><b>é</b></b>
</p>

<p>
ç‰¹æ®Šå­—ç¬¦
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">å­—ç¬¦</th>
<th scope="col" class="org-left">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>*</code></td>
<td class="org-left">é›¶æˆ–å¤šä¸ªï¼Œè´ªå©ªåŒ¹é…</td>
</tr>

<tr>
<td class="org-left"><code>+</code></td>
<td class="org-left">ä¸€æˆ–å¤šä¸ª</td>
</tr>

<tr>
<td class="org-left"><code>-</code></td>
<td class="org-left">é›¶æˆ–å¤šä¸ªï¼Œæœ€çŸ­åŒ¹é…</td>
</tr>

<tr>
<td class="org-left"><code>?</code></td>
<td class="org-left">é›¶æˆ–ä¸€ä¸ª</td>
</tr>

<tr>
<td class="org-left"><code>%n</code></td>
<td class="org-left">n = 1, 2, &#x2026;, 9 è¡¨ç¤ºç¬¬å‡ ä¸ªåŒ¹é…</td>
</tr>

<tr>
<td class="org-left"><code>%bxy</code></td>
<td class="org-left">x, y ä¸ºå­—ç¬¦ï¼Œä¾‹å¦‚ %b() è¡¨ç¤ºæ‹¬å·å¹³è¡¡çš„è¡¨è¾¾å¼</td>
</tr>

<tr>
<td class="org-left"><code>%f[set]</code></td>
<td class="org-left">è¾¹å¢ƒæ¨¡å¼ï¼ŒåŒ¹é…ä½äº set å†…æŸä¸ªå­—ç¬¦ä¹‹å‰çš„ç©ºä¸²</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org0a20a63" class="outline-2">
<h2 id="org0a20a63">Lua æ•°ç»„</h2>
<div class="outline-text-2" id="text-org0a20a63">
<p>
<b><b>ç›¸åŒæ•°æ®ç±»å‹æŒ‰ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆ</b></b>
</p>
</div>
<div id="outline-container-orgad7ef18" class="outline-3">
<h3 id="orgad7ef18">ä¸€ç»´æ•°ç»„</h3>
<div class="outline-text-3" id="text-orgad7ef18">
<div class="org-src-container">
<pre class="src src-lua">array = { "Lua", "Language" }

for i = 0, 2 do
  print(array[i])
end
</pre>
</div>

<p>
Lua ç´¢å¼•ä» 1 å¼€å§‹ï¼Œä½†å¯ä»¥æŒ‡å®š 0 å¼€å§‹
</p>
</div>
</div>
<div id="outline-container-org5e34821" class="outline-3">
<h3 id="org5e34821">å¤šç»´æ•°ç»„</h3>
<div class="outline-text-3" id="text-org5e34821">
<p>
å¤šç»´æ•°ç»„å³æ•°ç»„ä¸­åŒ…å«æ•°ç»„æˆ–ä¸€ç»´æ•°ç»„çš„ç´¢å¼•é”®å¯¹åº”ä¸€ä¸ªæ•°ç»„
</p>
</div>
</div>
</div>
<div id="outline-container-org333ccee" class="outline-2">
<h2 id="org333ccee">Lua è¿­ä»£å™¨</h2>
<div class="outline-text-2" id="text-org333ccee">
<p>
è¿­ä»£å™¨ iterator æ˜¯ä¸€ç§å¯¹è±¡ï¼Œèƒ½å¤Ÿç”¨æ¥éå†æ ‡å‡†æ¨¡æ¿åº“å®¹å™¨ä¸­çš„éƒ¨åˆ†æˆ–å…¨éƒ¨å…ƒç´ ï¼Œæ¯ä¸ªè¿­ä»£å¯¹è±¡ä»£è¡¨å®¹å™¨ä¸­çš„ç¡®å®šçš„åœ°å€ï¼ŒLua çš„è¿­ä»£å™¨æ˜¯ä¸€ç§æ”¯æŒæŒ‡é’ˆçš„ç»“æ„ã€‚
</p>
</div>
<div id="outline-container-orgb6009d6" class="outline-3">
<h3 id="orgb6009d6">æ³›å‹ for è¿­ä»£å™¨</h3>
<div class="outline-text-3" id="text-orgb6009d6">
<p>
æ³›å‹ for åœ¨å†…éƒ¨ä¿å­˜è¿­ä»£å‡½æ•°ã€çŠ¶æ€å¸¸é‡ã€æ§åˆ¶å˜é‡
</p>
<div class="org-src-container">
<pre class="src src-lua">array = {"a", "b"}

for key, value in ipairs(array)
do
  print(key, value)
end
</pre>
</div>

<p>
<code>ipairs()</code> æ˜¯ Lua é»˜è®¤æä¾›çš„è¿­ä»£å‡½æ•°ï¼Œ <code>pairs()</code> ä¼šå°† table å‹è½¬ä¸ºä¸€æ•´ä¸ªæ•°ç»„è¿›è¡Œå¤„ç†
</p>
</div>
</div>
<div id="outline-container-orgd243fa9" class="outline-3">
<h3 id="orgd243fa9">æ— çŠ¶æ€çš„è¿­ä»£å™¨</h3>
<div class="outline-text-3" id="text-orgd243fa9">
<p>
æŒ‡ä¸ä¿ç•™ä»»ä½•çŠ¶æ€çš„è¿­ä»£å™¨
</p>

<p>
æ¯ä¸€æ¬¡è¿­ä»£ï¼Œè¿­ä»£å‡½æ•°éƒ½æ˜¯ç”¨ä¸¤ä¸ªå˜é‡ï¼ˆçŠ¶æ€å¸¸é‡å’Œæ§åˆ¶å˜é‡ï¼‰çš„å€¼ä½œä¸ºå‚æ•°è¢«è°ƒç”¨ï¼Œä¸€ä¸ªæ— çŠ¶æ€çš„è¿­ä»£å™¨åªåˆ©ç”¨è¿™ä¸¤ä¸ªå€¼å¯ä»¥è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä¾‹å¦‚ <code>ipairs()</code> ï¼Œéå†æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ çš„ç´¢å¼•éœ€è¦æ˜¯æ•°å€¼
</p>

<p>
ğŸŒ°
</p>

<div class="org-src-container">
<pre class="src src-lua">function square(iteratorMaxCount, currentNumber)
  if currentNumber &lt; iteratorMaxCount
  then
    currentNumber = currentNumber + 1
  return currentNumber, currentNumber ^ 2
  end
end

for i, n in square, 3, 0
do
  print(i, n)
end
</pre>
</div>

<p>
ipairs å®ç°ï¼š
</p>

<div class="org-src-container">
<pre class="src src-lua">function iter(a, i)
  i = i + 1
  local v = a[i]
  if v then
    return i, v
  end
end

function ipairs(a)
  return iter, a, 0
end
</pre>
</div>

<p>
å½“ Lua è°ƒç”¨ ipairs(a) å¼€å§‹å¾ªç¯æ—¶ï¼Œä»–è·å–ä¸‰ä¸ªå€¼ï¼šè¿­ä»£å‡½æ•° iterã€çŠ¶æ€å¸¸é‡ aã€æ§åˆ¶å˜é‡åˆå§‹å€¼ 0ï¼›ç„¶å Lua è°ƒç”¨ iter(a, 0) è¿”å› 1, a[1]ï¼ˆé™¤é a[1]=nilï¼‰ï¼›ç¬¬äºŒæ¬¡è¿­ä»£è°ƒç”¨ iter(a,1) è¿”å› 2, a[2]â€¦â€¦ ç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ª nil å…ƒç´ ã€‚
</p>
</div>
</div>
<div id="outline-container-org43b4e30" class="outline-3">
<h3 id="org43b4e30">å¤šçŠ¶æ€çš„è¿­ä»£å™¨</h3>
<div class="outline-text-3" id="text-org43b4e30">
<p>
ä¿å­˜å¤šä¸ªçŠ¶æ€ä¿¡æ¯çš„è¿­ä»£å™¨ï¼Œæœ€ç®€å•æ–¹å¼æ˜¯é—­åŒ…ï¼Œæˆ–è€…å°†æ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯å°è£…åˆ° è¡¨ table å†…ï¼Œå°† table ä½œä¸ºè¿­ä»£å™¨çš„çŠ¶æ€å¸¸é‡
</p>

<p>
ğŸŒ°
</p>

<div class="org-src-container">
<pre class="src src-lua">array = {"a", "b"}

function elementIterator(collection)
  local index = 0
  local count = #collection
  return function()
    if index &lt;= count
    then
      return collection[index]
    end
  end
end

for element in elementIterator(array)
do
  print(element)
end
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7cd2018" class="outline-2">
<h2 id="org7cd2018">Lua è¡¨ table</h2>
<div class="outline-text-2" id="text-org7cd2018">
<p>
table æ˜¯å…³è”å‹æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„ç±»å‹çš„å€¼ï¼ˆé™¤ nilï¼‰ä½œä¸ºæ•°ç»„çš„ç´¢å¼•ï¼ŒåŒæ—¶ Lua é€šè¿‡ table æ¥è§£å†³æ¨¡å— (module), åŒ… (package) å’Œå¯¹è±¡ (Object)çš„
</p>

<p>
é€šè¿‡ <code>{}</code> æ¥æ„é€ ä¸€ä¸ª table
</p>

<div class="org-src-container">
<pre class="src src-lua">-- åˆå§‹åŒ–ä¸€ä¸ª table
mytable = {}

-- æŒ‡å®šæŸä¸ªç´¢å¼•å¯¹åº”çš„å€¼
mytable[1] = "Lua"

-- ç§»é™¤å¼•ç”¨
mytable = nil
-- lua çš„ gc ä¼šé‡Šæ”¾å†…å­˜ï¼Œå¼•ç”¨è®¡æ•°
</pre>
</div>
</div>
<div id="outline-container-org109aeff" class="outline-3">
<h3 id="org109aeff">å¸¸ç”¨æ–¹æ³•</h3>
<div class="outline-text-3" id="text-org109aeff">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">æ–¹æ³•</th>
<th scope="col" class="org-left">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">table.concat(table[, sep[, start[, end]]])</td>
<td class="org-left">concatenateï¼Œåˆ—å‡ºå‚æ•°ä¸­æŒ‡å®šçš„ table çš„æ•°ç»„éƒ¨åˆ†æŒ‡å®šä½ç½®çš„æ‰€æœ‰å…ƒç´ ï¼Œä»¥æŒ‡å®šçš„åˆ†éš”ç¬¦éš”å¼€</td>
</tr>

<tr>
<td class="org-left">table.insert(table, [pos, ] value)</td>
<td class="org-left">åœ¨æ•°ç»„çš„æŒ‡å®šä½ç½®æ’å…¥å€¼ä¸º value çš„å…ƒç´ ï¼Œé»˜è®¤æœ«å°¾</td>
</tr>

<tr>
<td class="org-left">table.maxn(table)</td>
<td class="org-left">æŒ‡å®š table ä¸­æ‰€æœ‰æ­£æ•° key å€¼ä¸­æœ€å¤§çš„ key å€¼ï¼Œlua 5.1 ä¹‹å‰å­˜åœ¨</td>
</tr>

<tr>
<td class="org-left">table.remove(table[, pos])</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">table.sort(table[, comp])</td>
<td class="org-left">å¯¹ table è¿›è¡Œæ’åº</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-lua">function table_maxn(t)
  local mn = nil
  for k, v in pairs(t) do
    if mn == nil then
      mn = v
    end
    if mn &lt; v then
      mn = v
    end
  end
  return mn
end

tbl = {[1] = 2, [2] = 6, [3] = 34, [26] = 5}

print("tbl æœ€å¤§å€¼ ", table_maxn(tbl))
print("tbl é•¿åº¦   ", #tbl)

-- tbl æœ€å¤§å€¼  34
-- tbl é•¿åº¦    3
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org58d582e" class="outline-2">
<h2 id="org58d582e">Lua æ¨¡å—ä¸åŒ…</h2>
<div class="outline-text-2" id="text-org58d582e">
<p>
Lua çš„æ¨¡å—æ˜¯ç”±å˜é‡ã€å‡½æ•°ç­‰å·²çŸ¥å…ƒç´ ç»„æˆçš„ table
</p>
</div>
<div id="outline-container-org34a8f72" class="outline-3">
<h3 id="org34a8f72">require å‡½æ•°</h3>
<div class="outline-text-3" id="text-org34a8f72">
<div class="org-src-container">
<pre class="src src-lua">require("module")

require "module"
</pre>
</div>
</div>
</div>
<div id="outline-container-org1836a8d" class="outline-3">
<h3 id="org1836a8d">åŠ è½½æœºåˆ¶</h3>
<div class="outline-text-3" id="text-org1836a8d">
<p>
require ç”¨äºæœç´¢ Lua æ–‡ä»¶çš„è·¯å¾„æ˜¯å­˜æ”¾åœ¨å…¨å±€å˜é‡ package.path ä¸­ï¼Œå½“ Lua å¯åŠ¨åï¼Œä¼šä»¥ç¯å¢ƒå˜é‡ LUA<sub>PATH</sub> çš„å€¼æ¥åˆå§‹è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ç¯å¢ƒå˜é‡ï¼Œåˆ™ä½¿ç”¨ä¸€ä¸ªç¼–è¯‘æ—¶å®šä¹‰çš„é»˜è®¤è·¯å¾„æ¥åˆå§‹åŒ–
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">LUA_PATH</span>
<span style="color: #006FE0;">export</span> <span style="color: #BA36A5;">LUA_PATH</span>=<span style="color: #008000;">"~/lua/?.lua;;"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdb047a6" class="outline-3">
<h3 id="orgdb047a6">C åŒ…</h3>
<div class="outline-text-3" id="text-orgdb047a6">
<p>
C åŒ…åœ¨ä½¿ç”¨ä»¥å‰å¿…é¡»é¦–å…ˆåŠ è½½å¹¶è¿æ¥ï¼Œåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­æœ€å®¹æ˜“çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡åŠ¨æ€è¿æ¥åº“æœºåˆ¶
</p>

<p>
Lua åœ¨ä¸€ä¸ªå« loadlib çš„å‡½æ•°å†…æä¾›äº†æ‰€æœ‰çš„åŠ¨æ€è¿æ¥çš„åŠŸèƒ½ã€‚è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šåº“çš„ç»å¯¹è·¯å¾„å’Œåˆå§‹åŒ–å‡½æ•°
</p>

<div class="org-src-container">
<pre class="src src-lua">local path = "/usr/local/lua/lib/libluasocket.so"
local f = loadlib(path, "luaopen_socket")
</pre>
</div>

<p>
loadlib å‡½æ•°åŠ è½½æŒ‡å®šçš„åº“å¹¶ä¸”è¿æ¥åˆ° Luaï¼Œç„¶è€Œå®ƒå¹¶ä¸è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ï¼Œè¿”å›åˆå§‹åŒ–å‡½æ•°ä½œä¸º Lua çš„å‡½æ•°
</p>

<div class="org-src-container">
<pre class="src src-lua">local path = "/usr/local/lua/lib/libluasocket.so"
local f = assert(loadlib(path, "luaopen_socket"))
f()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org595f60a" class="outline-2">
<h2 id="org595f60a">Lua å…ƒè¡¨ Metatable</h2>
<div class="outline-text-2" id="text-org595f60a">
<p>
å…è®¸æ”¹å˜ table çš„è¡Œä¸ºï¼Œæ¯ä¸ªè¡Œä¸ºå…³è”äº†å¯¹åº”çš„å…ƒæ–¹æ³•
</p>

<p>
â€œé‡è½½â€ï¼Œä¾‹å¦‚ Lua è¯•å›¾å¯¹ä¸¤ä¸ªè¡¨ç›¸åŠ æ—¶ï¼Œå…ˆæ£€æŸ¥ä¸¤è€…ä¹‹ä¸€æ˜¯å¦æœ‰å…ƒè¡¨ï¼Œä¹‹åæ£€æŸ¥æ˜¯å¦æœ‰ä¸€ä¸ªå« <code>__add</code> çš„å­—æ®µï¼Œè‹¥æ‰¾åˆ°ï¼Œåˆ™è°ƒç”¨å¯¹åº”çš„å€¼ã€‚
</p>

<p>
ç›¸å…³å‡½æ•°ï¼š
</p>
<ul class="org-ul">
<li><code>setmetatable(table, metatable)</code> å¯¹æŒ‡å®šè¡¨è®¾ç½®å…ƒè¡¨ï¼Œå¦‚æœå…ƒè¡¨ <code>metatable</code> ä¸­å­˜åœ¨ <code>__metatable</code> é”®å€¼ï¼Œæ­¤å‡½æ•°ä¼šå¤±è´¥</li>
<li><code>getmetatable(table)</code> è¿”å› table çš„å…ƒè¡¨</li>
</ul>
</div>
<div id="outline-container-org421d22a" class="outline-3">
<h3 id="org421d22a"><code>__index</code> å…ƒæ–¹æ³•</h3>
<div class="outline-text-3" id="text-org421d22a">
<p>
å®šä¹‰äº†è¡¨åœ¨ç´¢å¼•å¤±è´¥çš„æƒ…å†µä¸‹è¯¥æ€ä¹ˆåŠ
</p>

<p>
å…ƒè¡¨æœ€å¸¸ç”¨çš„é”®ï¼Œå½“é€šè¿‡é”®æ¥è®¿é—® table çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªé”®æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆ Lua å°±ä¼šå¯»æ‰¾è¯¥ table çš„å…ƒè¡¨ä¸­çš„ <code>__index</code> é”®ï¼Œå¦‚æœ <code>__index</code> åŒ…å«ä¸€ä¸ªè¡¨æ ¼ï¼ŒLua ä¼šåœ¨è¡¨æ ¼ä¸­æŸ¥æ‰¾ç›¸åº”çš„é”®
</p>

<p>
å¦‚æœ <code>__index</code> åŒ…å«ä¸€ä¸ªå‡½æ•°çš„è¯ï¼ŒLua å°±ä¼šè°ƒç”¨é‚£ä¸ªå‡½æ•°ï¼Œtable å’Œé”®ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°
</p>

<p>
<code>__index</code> å…ƒæ–¹æ³•æŸ¥çœ‹è¡¨ä¸­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›ç»“æœä¸º <code>nil~ï¼›å¦‚æœå­˜åœ¨åˆ™ç”± ~__index</code> è¿”å›ç»“æœ
</p>

<p>
ğŸŒ°
</p>
<div class="org-src-container">
<pre class="src src-lua">mytable = setmetatable({key1 = "value1"}, {
  __index = function(mytable, key)
    if key == "key2" then
      return "metatablevalue"
    else
      return nil
    end
  end
})

print(mytable.key1, mytable.key2)

--[[
  mytable çš„ key2 å®é™…å¹¶ä¸å­˜åœ¨
  ä½† mytable å­˜åœ¨å…ƒè¡¨
  å¦‚æœå…ƒè¡¨å®šä¹‰äº† __index
  å°±ä¼šè°ƒç”¨è¿™ä¸ª __index æ–¹æ³•
  è‹¥ __index ä¸º nilï¼Œå³æœªå®šä¹‰
  è¿”å› nil
  è‹¥ __index æ˜¯ä¸€ä¸ª table
  åˆ™åœ¨å…ƒè¡¨çš„ table æŸ¥æ‰¾è¯¥ç´¢å¼•
  è‹¥ __index æ˜¯ä¸€ä¸ª å‡½æ•°
  åˆ™è°ƒç”¨è¯¥å‡½æ•°å¹¶è¿”å›å‡½æ•°ç»“æœ

  å¯ä»¥æŠŠå…ƒè¡¨ç†è§£ä¸€ä¸ª table çš„æ“ä½œæŒ‡å—
]]

-- value1 metatablevalue

mytable = setmetatable({key = "value1"}, {__index = {key2 = "metatablevalue"}})
</pre>
</div>
</div>
</div>
<div id="outline-container-org52d5b5b" class="outline-3">
<h3 id="org52d5b5b"><code>__newindex</code> å…ƒæ–¹æ³•</h3>
<div class="outline-text-3" id="text-org52d5b5b">
<p>
<code>__newindex</code> ç”¨æ¥å¯¹è¡¨æ›´æ–°ï¼Œå½“ç»™ table ä¸€ä¸ªç¼ºå°‘çš„ç´¢å¼•èµ‹å€¼ï¼Œè§£é‡Šå™¨å°±ä¼šæŸ¥æ‰¾ <code>__newindex</code> å…ƒæ–¹æ³•ï¼šå¦‚æœå­˜åœ¨å°±è°ƒç”¨è¿™ä¸ªå‡½æ•°è€Œä¸è¿›è¡Œèµ‹å€¼æ“ä½œ
</p>

<p>
ğŸŒ°
</p>
<div class="org-src-container">
<pre class="src src-lua">mymetatable = {}
mytable = setmetable({key1 = "value1"}, {__newindex = mymetatable})

print(mytable.key1)

mytable.newkey = "newvalue"
print(mytable.newkey, mymetable.newkey)

mytable.key1 = "value11"
print(mytable.key1, mymetatable.key1)

-- value
-- nil newvalue
-- value11 nil
</pre>
</div>

<p>
ğŸŒ°
</p>
<div class="org-src-container">
<pre class="src src-lua">mytable = setmetable({key1 = "value1"}, {
  __newindex = function(mytable, key, value)
    rawset(mytable, key, "\""..value.."\"")
  end
})

mytable.key1 = "newvalue"
mytable.key2 = 4

print(mytable.key1, mytable.key2)

-- newvalue "4"
</pre>
</div>
</div>
</div>
<div id="outline-container-org153d759" class="outline-3">
<h3 id="org153d759"><code>__call</code> å…ƒæ–¹æ³•</h3>
<div class="outline-text-3" id="text-org153d759">
<p>
åœ¨ Lua è°ƒç”¨ table çš„ä¸€ä¸ªå€¼æ—¶è°ƒç”¨
</p>
</div>
</div>
<div id="outline-container-orgbf294e2" class="outline-3">
<h3 id="orgbf294e2"><code>__string</code> å…ƒæ–¹æ³•</h3>
<div class="outline-text-3" id="text-orgbf294e2">
<p>
ä¿®æ”¹ table çš„è¾“å‡ºè¡Œä¸º
</p>
</div>
</div>
<div id="outline-container-org78e2edb" class="outline-3">
<h3 id="org78e2edb">å…¶ä»–å…ƒæ–¹æ³•</h3>
<div class="outline-text-3" id="text-org78e2edb">
<div class="org-src-container">
<pre class="src src-lua">__add    +
__sub    -
__mul    *
__div    /
__mod    %
__unm    -
__concat ..
__eq     ==
__lt     &lt;
__le     &lt;=
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf6ef60d" class="outline-2">
<h2 id="orgf6ef60d">Lua ååŒç¨‹åº coroutine</h2>
<div class="outline-text-2" id="text-orgf6ef60d">
<p>
Lua ååŒç¨‹åº (coroutine) ä¸çº¿ç¨‹æ¯”è¾ƒç±»ä¼¼ï¼šæ‹¥æœ‰ç‹¬ç«‹çš„å †æ ˆï¼Œç‹¬ç«‹çš„å±€éƒ¨å˜é‡ï¼Œç‹¬ç«‹çš„æŒ‡ä»¤æŒ‡é’ˆï¼ŒåŒæ—¶åˆä¸å…¶å®ƒååŒç¨‹åºå…±äº«å…¨å±€å˜é‡å’Œå…¶å®ƒå¤§éƒ¨åˆ†ä¸œè¥¿
</p>
</div>
<div id="outline-container-orga610242" class="outline-3">
<h3 id="orga610242">çº¿ç¨‹å’ŒååŒç¨‹åºåŒºåˆ«</h3>
<div class="outline-text-3" id="text-orga610242">
<p>
çº¿ç¨‹ä¸ååŒç¨‹åºçš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œä¸€ä¸ªå…·æœ‰å¤šä¸ªçº¿ç¨‹çš„ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå‡ ä¸ªçº¿ç¨‹ï¼Œè€ŒååŒç¨‹åºå´éœ€è¦å½¼æ­¤åä½œçš„è¿è¡Œï¼›åœ¨ä»»ä¸€æŒ‡å®šæ—¶åˆ»åªæœ‰ä¸€ä¸ªååŒç¨‹åºåœ¨è¿è¡Œï¼Œå¹¶ä¸”è¿™ä¸ªæ­£åœ¨è¿è¡Œçš„ååŒç¨‹åºåªæœ‰åœ¨æ˜ç¡®çš„è¢«è¦æ±‚æŒ‚èµ·çš„æ—¶å€™æ‰ä¼šè¢«æŒ‚èµ·
</p>

<p>
ååŒç¨‹åºæœ‰ç‚¹ç±»ä¼¼åŒæ­¥çš„å¤šçº¿ç¨‹
</p>
</div>
</div>
<div id="outline-container-org2a6dd93" class="outline-3">
<h3 id="org2a6dd93">åŸºæœ¬æ–¹æ³•</h3>
<div class="outline-text-3" id="text-org2a6dd93">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">æ–¹æ³•</th>
<th scope="col" class="org-left">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">coroutine.create()</td>
<td class="org-left">åˆ›å»ºå¹¶è¿”å› coroutineï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°</td>
</tr>

<tr>
<td class="org-left">coroutine.resume()</td>
<td class="org-left">å¯åŠ¨/ç»§ç»­ coroutine</td>
</tr>

<tr>
<td class="org-left">coroutine.yield()</td>
<td class="org-left">æŒ‚èµ· coroutine</td>
</tr>

<tr>
<td class="org-left">coroutine.status()</td>
<td class="org-left">æŸ¥çœ‹ coroutine çŠ¶æ€ï¼ŒåŒ…å« dead, suspended, running</td>
</tr>

<tr>
<td class="org-left">coroutine.wrap()</td>
<td class="org-left">åˆ›å»º coroutineï¼Œè°ƒç”¨æ—¶è¿›å…¥ coroutine</td>
</tr>

<tr>
<td class="org-left">coroutine.running()</td>
<td class="org-left">è¿”å›æ­£åœ¨è¿è¡Œçš„ coroutine</td>
</tr>
</tbody>
</table>

<p>
resume å’Œ create é…åˆä½¿ç”¨æ—¶å°±å”¤é†’å‡½æ•°è°ƒç”¨
</p>

<p>
ğŸŒ° - ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜
</p>
<div class="org-src-container">
<pre class="src src-lua">local newProductor

function productor()
  local i = 0
  while true do
    i = i + 1
    send(i)
  end
end

fuction consumer()
  while true do
    local i = receive()
    print(i)
  end
end

function receive()
  local status, value = coroutine.resume(newProductor)
  return value
end

function send(x)
  coroutine.yield(x)
end

newProductor = coroutine.create(productor)
consumer()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org67baa02" class="outline-2">
<h2 id="org67baa02">Lua I/O</h2>
<div class="outline-text-2" id="text-org67baa02">
<ul class="org-ul">
<li>ç®€å•æ¨¡å¼ï¼šæ‹¥æœ‰ä¸€ä¸ªå½“å‰è¾“å…¥æ–‡ä»¶å’Œå½“å‰è¾“å‡ºæ–‡ä»¶ï¼Œå¹¶ä¸”æä¾›å¯¹è¿™äº›æ–‡ä»¶çš„ç›¸å…³æ“ä½œ</li>
<li>å®Œå…¨æ¨¡å¼ï¼šä½¿ç”¨å¤–éƒ¨çš„æ–‡ä»¶å¥æŸ„æ¥å®ç°ï¼Œä»¥ä¸€ç§é¢å‘å¯¹è±¡çš„å½¢å¼ï¼Œå°†æ‰€æœ‰çš„æ–‡ä»¶æ“ä½œå®šä¹‰ä¸ºæ–‡ä»¶å¥æŸ„çš„æ–¹æ³•</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua">file = io.open(filename[, mode])
</pre>
</div>

<p>
mode:
</p>
<ul class="org-ul">
<li>r  åªè¯»ï¼Œæ–‡ä»¶å¿…é¡»å­˜åœ¨</li>
<li>w  åªå†™</li>
<li>a  é™„åŠ </li>
<li>r+ å¯è¯»å†™ï¼Œæ–‡ä»¶å¿…é¡»å­˜åœ¨</li>
<li>w+ å¯è¯»å†™</li>
<li>a+ å¯è¯»å†™</li>
<li>b  äºŒè¿›åˆ¶</li>
<li>+  å¯è¯»å†™</li>
</ul>
</div>
<div id="outline-container-orgf315889" class="outline-3">
<h3 id="orgf315889">ç®€å•æ¨¡å¼</h3>
<div class="outline-text-3" id="text-orgf315889">
<p>
ğŸŒ°
</p>
<div class="org-src-container">
<pre class="src src-lua">-- ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶
file = io.open("test.lua", "r")

-- è®¾ç½®é»˜è®¤è¾“å…¥æ–‡ä»¶ä¸º test.lua
io.input(file)

-- è¾“å‡ºæ–‡ä»¶ç¬¬ä¸€è¡Œ
print(io.read())

-- å…³é—­æ‰“å¼€çš„æ–‡ä»¶
io.close(file)

-- ä»¥é™„åŠ çš„æ–¹å¼æ‰“å¼€åªå†™æ–‡ä»¶
file = io.open("test.lua", "a")

-- è®¾ç½®é»˜è®¤è¾“å‡ºæ–‡ä»¶ä¸º test.lua
io.output(file)

-- åœ¨æ–‡ä»¶æœ€åä¸€è¡Œæ·»åŠ  Lua æ³¨é‡Š
io.write("--  test.lua æ–‡ä»¶æœ«å°¾æ³¨é‡Š")

-- å…³é—­æ‰“å¼€çš„æ–‡ä»¶
io.close(file)
</pre>
</div>

<p>
read å‡½æ•°çš„å‚æ•°
</p>
<ul class="org-ul">
<li><code>"*n"</code>  è¯»å–ä¸€ä¸ªæ•°å­—å¹¶è¿”å›</li>
<li><code>"*a"</code>  ä»å½“å‰ä½ç½®è¯»å–æ•´ä¸ªæ–‡ä»¶</li>
<li><code>"*l</code>   è¯»å–ä¸‹ä¸€è¡Œ</li>
<li>number  è¿”å›ä¸€ä¸ªæŒ‡å®šå­—ç¬¦ä¸ªæ•°çš„å­—ç¬¦ä¸²ï¼Œæˆ–åœ¨ EOF æ—¶è¿”å› nil</li>
</ul>

<p>
io.tmpfile() è¿”å›ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¥æŸ„ï¼Œè¯¥æ–‡ä»¶ä»¥æ›´æ–°æ¨¡å¼æ‰“å¼€ï¼Œç¨‹åºç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤
</p>

<p>
io.type(file) æ£€æµ‹ obj æ˜¯å¦æ˜¯ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶å¥æŸ„
</p>

<p>
io.flush() å‘æ–‡ä»¶å†™å…¥ç¼“å†²ä¸­çš„æ‰€æœ‰æ•°æ®
</p>

<p>
io.lines(optional file name) è¿”å›ä¸€ä¸ªè¿­ä»£å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨è·å–æ–‡ä»¶ä¸­ä¸€è¡Œå†…å®¹
</p>
</div>
</div>
<div id="outline-container-org483d48e" class="outline-3">
<h3 id="org483d48e">å®Œå…¨æ¨¡å¼</h3>
<div class="outline-text-3" id="text-org483d48e">
<p>
åŒä¸€æ—¶é—´å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ <a href="./function_name">./function_name</a> æ¥ä»£æ›¿ io.function<sub>name</sub> æ–¹æ³•
</p>

<div class="org-src-container">
<pre class="src src-lua">-- ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶
file = io.open("test.lua", "r")

-- è¾“å‡ºæ–‡ä»¶ç¬¬ä¸€è¡Œ
print(file:read())

-- å…³é—­æ‰“å¼€çš„æ–‡ä»¶
file:close()

-- ä»¥é™„åŠ çš„æ–¹å¼æ‰“å¼€åªå†™æ–‡ä»¶
file = io.open("test.lua", "a")

-- åœ¨æ–‡ä»¶æœ€åä¸€è¡Œæ·»åŠ  Lua æ³¨é‡Š
file:write("--test")

-- å…³é—­æ‰“å¼€çš„æ–‡ä»¶
file:close()
</pre>
</div>

<p>
æ–¹æ³•ï¼š
</p>

<p>
<a href="./seek">./seek</a>(optional whence, optional offset) è®¾ç½®å’Œè·å–å½“å‰æ–‡ä»¶ä½ç½®ï¼ŒæˆåŠŸåˆ™è¿”å›æœ€ç»ˆçš„æ–‡ä»¶ä½ç½®ï¼Œå¤±è´¥åˆ™è¿”å› nil åŠ é”™è¯¯ä¿¡æ¯
</p>

<p>
whence =
</p>
<ul class="org-ul">
<li>&ldquo;set&rdquo; ä»æ–‡ä»¶å¤´å¼€å§‹</li>
<li>&ldquo;cur&rdquo; ä»å½“å‰ä½ç½®å¼€å§‹</li>
<li>&ldquo;end&rdquo; ä»æ–‡ä»¶å°¾å¼€å§‹</li>
</ul>

<p>
offset é»˜è®¤ä¸º 0
</p>

<p>
<a href="./flush()">./flush()</a>
</p>

<p>
<a href="./lines">./lines</a>(optional file name)
</p>
</div>
</div>
</div>
<div id="outline-container-orgc788674" class="outline-2">
<h2 id="orgc788674">Lua é”™è¯¯å¤„ç†</h2>
<div class="outline-text-2" id="text-orgc788674">
</div>
<div id="outline-container-org0c23ae5" class="outline-3">
<h3 id="org0c23ae5">assert()</h3>
<div class="outline-text-3" id="text-org0c23ae5">
<p>
assert(argument, message)
</p>

<p>
assert é¦–å…ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè‹¥æ²¡é—®é¢˜ï¼Œassert ä¸åšä»»ä½•äº‹æƒ…ï¼›å¦åˆ™ï¼Œassert ä»¥ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºé”™è¯¯ä¿¡æ¯æŠ›å‡º
</p>
</div>
</div>
<div id="outline-container-orgf2e4395" class="outline-3">
<h3 id="orgf2e4395">error()</h3>
<div class="outline-text-3" id="text-orgf2e4395">
<p>
error(message[, level])
</p>

<p>
ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œå¹¶è¿”å› message çš„å†…å®¹ä½œä¸ºé”™è¯¯ä¿¡æ¯
</p>

<p>
level å‚æ•°æŒ‡ç¤ºè·å¾—é”™è¯¯çš„ä½ç½®
</p>
<ul class="org-ul">
<li>1 é»˜è®¤ï¼Œä¸ºè°ƒç”¨ error çš„ä½ç½®ï¼Œæ–‡ä»¶ + è¡Œå·</li>
<li>2 æŒ‡å‡ºé‚£ä¸ªè°ƒç”¨ error çš„å‡½æ•°</li>
<li>0 ä¸æ·»åŠ é”™è¯¯ä½ç½®ä¿¡æ¯</li>
</ul>
</div>
</div>
<div id="outline-container-org28c8ef0" class="outline-3">
<h3 id="org28c8ef0">pcall, xpcall</h3>
<div class="outline-text-3" id="text-org28c8ef0">
<p>
pcall æ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œè¦ä¼ é€’ç»™åè€…çš„å‚æ•°ï¼Œå¹¶æ‰§è¡Œï¼Œè¿”å›å€¼ true / false, errorinfo
</p>

<div class="org-src-container">
<pre class="src src-lua">if pcall(function_name) then

else

end
</pre>
</div>

<p>
xpcall ç›¸æ¯”ä¸ pcall æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼šä¸€ä¸ªé”™è¯¯å¤„ç†å‡½æ•°ï¼Œå½“é”™è¯¯å‘ç”Ÿæ—¶ï¼ŒLua ä¼šåœ¨è°ƒç”¨æ ˆå±•å¼€ (unwind) å‰è°ƒç”¨é”™è¯¯å¤„ç†å‡½æ•°
</p>
</div>
</div>
<div id="outline-container-orge42d833" class="outline-3">
<h3 id="orge42d833">debug åº“</h3>
</div>
</div>
<div id="outline-container-org569a4ac" class="outline-2">
<h2 id="org569a4ac">Lua åƒåœ¾å›æ”¶</h2>
<div class="outline-text-2" id="text-org569a4ac">
<p>
Lua è¿è¡Œäº†ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨æ¥æ”¶é›†æ‰€æœ‰æ­»å¯¹è±¡ï¼Œå®ç°äº†ä¸€ä¸ªå¢é‡æ ‡è®°-æ‰«ææ”¶é›†å™¨ã€‚ä½¿ç”¨ä¸¤ä¸ªæ ‡è®°æ¥æ§åˆ¶åƒåœ¾æ”¶é›†å¾ªç¯ï¼Œå•ä½éƒ½æ˜¯ç™¾åˆ†æ•°
</p>

<ul class="org-ul">
<li>åƒåœ¾æ”¶é›†å™¨é—´æ­‡ç‡    200 è¡¨ç¤º 2 å€å†…å­˜æ—¶å¼€å§‹æ–°çš„å¾ªç¯</li>
<li>åƒåœ¾æ”¶é›†å™¨æ­¥è¿›å€ç‡  200 è¡¨ç¤ºä»¥å†…å­˜åˆ†é…çš„ 2 å€é€Ÿå·¥ä½œ</li>
</ul>

<p>
collectgarbage([opt [, arg]])
</p>

<p>
opt =
</p>
<ul class="org-ul">
<li>&ldquo;collect&rdquo;  åšä¸€æ¬¡å®Œæ•´çš„åƒåœ¾å¾ªç¯</li>
<li>&ldquo;count&rdquo;    ä»¥ K å­—èŠ‚æ•°ä¸ºå•ä½è¿”å› Lua ä½¿ç”¨çš„æ€»å†…å­˜æ•°</li>
<li>&ldquo;restart&rdquo;  é‡å¯åƒåœ¾æ”¶é›†å™¨çš„è‡ªåŠ¨è¿è¡Œ</li>
<li>&ldquo;setpause&rdquo; å°† arg è®¾ä¸ºæ”¶é›†å™¨çš„é—´æ­‡ç‡ï¼Œè¿”å›é—´æ­‡ç‡çš„å‰å€¼</li>
<li>&ldquo;step&rdquo;     å•æ­¥è¿è¡Œåƒåœ¾æ”¶é›†å™¨</li>
<li>&ldquo;stop&rdquo;     åœæ­¢åƒåœ¾æ”¶é›†å™¨çš„è¿è¡Œ</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">

                     Theme
                     <a href="https://github.com/fniessen/org-html-themes" target="_blank">bigblow</a>
                     by
                     <a href="https://github.com/fniessen" target="_blank">fniessen</a>
                     <br>
                     <a href="https://beian.miit.gov.cn" target="_blank">æ¹˜ICPè¯019014083å·</a>
</div>
</body>
</html>